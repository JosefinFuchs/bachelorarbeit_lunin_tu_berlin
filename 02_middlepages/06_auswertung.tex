\chapter{Auswertung}
\label{text:auswertung}
Die Auswertung von Aufnahmen wird durch ihre Größe erschwert. In einer Aufnahme-Session wird es ca. \numrange{75000}{100000} Aufnahmen gemacht, die insgesamt ca. 180GB groß sind. Jede Aufnahme muss einzeln und kann von anderen Aufnahmen unabhängig ausgewertet werden. So ist der Auswertungsvorgang leicht parallelisierbar. Benutzt wird die „high-level“ API Bibliothek \textit{dask-image} \cite{dask-library}, die parallelisierte und optimierte Ausführung der eingegebenen Funktionen ohne großen technischen Aufwand zulässt.

\noindent
Das gemitteltes Dunkelbild von \num{10000} aufgenommenen Dunkelbildern wird ermittelt und als einzelnes Bild gespeichert. In dem Bild soll das statistische Rauschen durch die Mittlung über große Aufnahmenzahl eliminiert. So bleibt lediglich der konstante Offset von jedem Pixel in dem Bild, der erwartet groß sein soll. Das gemittelte Bild wird von jeder Aufnahme vor der weiteren Auswertung subtrahiert.

\noindent
\begin{figure}[H]
    \centering
    \input{images/auswertung/noise_hist_fit.pgf}
    \caption{\num{10000} Dunkelbilder}
    \label{fig:noise_hist_fit}
\end{figure}

\noindent
Die resultierende Differenz, die in der Abb. \ref{fig:capture_ped_diff}c) abgebildet ist, ist, wie erwartet, extrem klein gegenüber das Rohbild und das gemittelte Dunkelbild, die in der Abb. \ref{fig:capture_ped_diff}a) bzw. \ref{fig:capture_ped_diff}b) zu sehen sind. 
\begin{figure}[H]
    \centering
    \input{images/auswertung/capture_ped_diff.pgf}
    \caption{(a) eine Einzelaufnahme der gestreuten Photonen, (b) ein gemitteltes Bild über \num{10000} Dunkelbilder und (c) die resultierende Differenz von ersten zwei Bildern.}
    \label{fig:capture_ped_diff}
\end{figure}

\noindent
Bei jedem Auswertungsvorgang werden die beiden Algorithmen (Abschnitte \ref{text:threshold_algorithm} und \ref{text:clustering_algorithm}) eingesetzt und die Auswertungsergebnisse werden miteinander verglichen.
\section{Hintergrundrauschen Auswertung der Streubilder}
\label{text:streuung_counting}
\subsection{Schwellenwert}
Die Messdaten wurden zuerst mit dem Schwellenwert-Algorithmus verarbeitet, wobei der Schwellenwert $s_V$ im Intervall von \SIrange{50}{260}{\adu} variiert wird. In der Abbildung \ref{fig:th_50_100_125_150_170_180_200_220_260} werden die Ergebnisse der Algorithmusverarbeitung in log-Skala dargestellt.
\begin{figure}[H]
    \centering
    \input{images/auswertung/th_50_100_125_150_170_180_200_220_260.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{50}{\adu}, (b) \SI{100}{\adu}, (c) \SI{125}{\adu}, (d) \SI{150}{\adu}, (e) \SI{170}{\adu}, (f) \SI{180}{\adu}, (g) \SI{200}{\adu}, (h) \SI{220}{\adu} und (g) \SI{260}{\adu}. Aufsummiert werden jeweils \num{50000} Aufnahmen. Die dunklere horizontale Linie im Direktstrahlzentrum entspricht der Gd M5 Absorptionskante.}
    \label{fig:th_50_100_125_150_170_180_200_220_260}
\end{figure}
In der Abb. \ref{fig:th_50_100_125_150_170_180_200_220_260}a), wo der Schwellenwert $s_V = \SI{50}{\adu}$ gleich ist, 



% \begin{figure}[H]
%     \centering
%     \input{images/auswertung/th_150_sums.pgf}
%     \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert \SI{150}{\adu}, wobei es (a) \num{1}, (b) \num{5}, (c) \num{1000}, (d) \num{10000}, (e) \num{20000} und (f) \num{50000} Aufnahmen aufsummiert werden. Es werden jeweils \num{6}, \num{41}, \num{13262}, \num{135780}, \num{264699} und \num{543377} Photonen gezählt.}
%     \label{fig:th_150_sums}
% \end{figure}


Die Zahl der detektierten Photonen mit dem variablen Schwellenwert lässt quantitativ anschauen, wie stark der erwartete \gls{adu}-Wert eines Photons $W_\text{Gd, M5} =  \SI{180(1)}{\adu}$ (s. Gl. (\ref{eq:auselesewerte_fe_gd})).
\begin{figure}[H]
    \centering
    \input{images/auswertung/th_0_100_125_150_170_180.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{0}{\adu}, (b) \SI{100}{\adu}, (c) \SI{125}{\adu}, (d) \SI{150}{\adu}, (e) \SI{170}{\adu} und (f) \SI{180}{\adu}. Aufsummiert werden jeweils \num{50000} Aufnahmen. Eine dunklere Linie im Zentrum vom Direktstrahl entspricht der Absorptionskante. Aufgenommen an der Resonanzfrequenz Gd M5.}
    \label{fig:th_0_100_125_150_170_180}
\end{figure}




\noindent
In der Abb. \ref{fig:th_0_100_125_150_170_180} es ist 
% \begin{figure}[H]
%     \centering
%     \input{images/auswertung/th_150_170_180.pgf}
%     \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{150}{\adu}, (b) \SI{170}{\adu} und (c) \SI{180}{\adu}. Aufsummiert werden \num{50000} Aufnahmen.}
%     \label{fig:th_150_170_180}
% \end{figure}
\begin{figure}[H]
    \centering
    \input{images/auswertung/th_180_450_600.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{180}{\adu}, (b) \SI{450}{\adu} und (c) \SI{600}{\adu}. Aufsummiert werden \num{50000} Aufnahmen. Die detektierten Photonen, die mit allen Schwellenwerten auftauchen, werden mit grün eingekreist. }
    \label{fig:th_180_450_600}
\end{figure}

\begin{figure}[H]
    \centering
    \input{images/auswertung/th_150_200_masked_radial_transform.pgf}
    \caption{}
    \label{fig:th-150-200-maske-radial-transform}
\end{figure}
\begin{figure}[H]
    \centering
    \input{images/auswertung/radius_fit.pgf}
    \caption{}
    \label{fig:radius_fit}
\end{figure}

\noindent
Um den magnetischen Charakter dieses Effekts nachzuweisen, wurde eine Kontrollmessung an einer niedrigeren Photonenenergie, die weit von der Resonanzenergie $h\nu_{\text{Gd, M5}}$ liegt, durchgeführt. Die Kontrollmessung soll an einer kleineren Energie daher stattfinden, weil die Beträge von Streukoeffizienten im Zwischenbereich von Resonanzenergien $h\nu_{\text{Gd, M5}}$ und $h\nu_{\text{Gd, M4}}$ nicht komplett verschwinden und fürs Beobachten des Streuringes ausreichend bleiben können.

\begin{figure}[H]
    \centering
    \input{images/auswertung/th_0_100_125_150_170_180_off_resonance.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{0}{\adu}, (b) \SI{100}{\adu}, (c) \SI{125}{\adu}, (d) \SI{150}{\adu}, (e) \SI{170}{\adu} und (f) \SI{180}{\adu}. Aufsummiert werden jeweils \num{50000} Aufnahmen. Aufgenommen weit von Gd M5 Resonanzfrequenz.}
    \label{fig:th_0_100_125_150_170_180_off_resonance}
\end{figure}
\subsection{Clustering}
\noindent
Test
\begin{figure}[H]
    \centering
    \input{images/auswertung/cl_2_0_100_125_150_170_180_resonance.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{150}{\adu}, (b) \SI{180}{\adu}, (c) \SI{200}{\adu}, (d) \SI{220}{\adu}, (e) \SI{250}{\adu} und (f) \SI{290}{\adu}. Aufsummiert werden jeweils \num{50000} Aufnahmen. Aufgenommen an der Gd M5 Resonanzfrequenz.}
    \label{fig:cl_2_0_100_125_150_170_180_resonance}
\end{figure}

\begin{figure}[H]
    \centering
    \input{images/auswertung/cl_150_180_200_220_250_290_off_resonance.pgf}
    \caption{Anzahl von den detektierten Photonen mithilfe des Schwellenwert-Algorithmuses mit dem Schwellenwert (a) \SI{150}{\adu}, (b) \SI{180}{\adu}, (c) \SI{200}{\adu}, (d) \SI{220}{\adu}, (e) \SI{250}{\adu} und (f) \SI{290}{\adu}. Aufsummiert werden jeweils \num{50000} Aufnahmen. Aufgenommen weit von Gd M5 Resonanzfrequenz.}
    \label{fig:cl_150_180_200_220_250_290_off_resonance}
\end{figure}
\begin{figure}[H]
    \centering
    \input{images/auswertung/no_pr_cl_2_cl_3_histograms.pgf}
    \caption{Histogramme der (a) direkten Pixelwerte und der mit (b) 2x2- und (c) 3x3- Clustering-Algorithmus bearbeiteten Pixelwerte. In den jeweils eingefügten Graphen sind die Bereiche detailliert dargestellt, wo sich die Schnittpunkte (vertikale Linien) von Dunkelbilder- und Streubilder-Histogramme befinden. Für jedes Histogramm werden \num{10000} Dunkelbilder sowie Streubilder verwendet.}
    \label{fig:no_pr_cl_2_cl_3_histograms}
\end{figure}
...
\section{Ermittlung des tatsächlichen Photonenflusses}
\label{text:butterfly_counting}

